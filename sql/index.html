<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|ZCOOL XiaoWei:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/5.10.0-11/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css">
  <script src="//cdn.jsdelivr.net/npm/pace-js@1/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"qianling.pw","root":"/","scheme":"Muse","version":"7.7.1","exturl":false,"sidebar":{"position":"right","display":"hide","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="《SQL 基础教程》笔记">
<meta property="og:url" content="https://qianling.pw/sql/index.html">
<meta property="og:site_name" content="千灵">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://qianling.pw/images/covers/181.jpg">
<meta property="article:published_time" content="2020-03-17T13:10:36.000Z">
<meta property="article:modified_time" content="2020-04-21T11:57:23.000Z">
<meta property="article:author" content="千灵夙赋">
<meta property="article:tag" content="计算机科学">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://qianling.pw/images/covers/181.jpg">

<link rel="canonical" href="https://qianling.pw/sql/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>《SQL 基础教程》笔记 | 千灵</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-141264217-1"></script>
    <script pjax>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-141264217-1');
      }
    </script>


  <script pjax>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b95f636e57f871a4ea1faeae2b4f30e5";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="千灵" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">千灵</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-right"></div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-star-half-alt"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-democrat"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-dove"></i>分类</a>

  </li>
        <li class="menu-item menu-item-daily">

    <a href="/daily" rel="section"><i class="fa fa-fw fa-ghost"></i>碎念</a>

  </li>
        <li class="menu-item menu-item-play">

    <a href="/play" rel="section"><i class="fa fa-fw fa-fish"></i>游戏</a>

  </li>
        <li class="menu-item menu-item-comments">

    <a href="/comments" rel="section"><i class="fa fa-fw fa-dog"></i>留言</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-carrot"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
<script src="/js/custom/custom.js"></script>

<div class="top-scroll-bar"></div>

<!-- 点击特效 -->
<canvas class="fireworks" id="canvas" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
<script>
if( !/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)){
  document.write('<script type="text/javascript" src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"><\/script> <script type="text/javascript" src="/js/custom/fireworks.js"><\/script>');
}
</script>

<!-- 动态背景 -->
<script>
if( !/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)){
  document.write('<script type="text/javascript" src="/js/custom/jquery.backstretch.min.js"><\/script>');
}
</script>
<script type="text/javascript">
  $("body").backstretch([
    "https://qianling-1254036047.cos.ap-chengdu.myqcloud.com/background/background%20(1).webp",
    "/images/background/background (2).webp",
    "/images/background/background (3).webp",
    "/images/background/background (4).webp",
    "/images/background/background (5).webp",
    "/images/background/background (6).webp",
    "/images/background/background (7).webp",
    "/images/background/background (8).webp",
  ], {duration: 20000, fade: 1000, animateFirst: true});
</script>

<!-- live2d -->
<div id="waifu">
  <div class="waifu-tips" style="opacity: 0;"></div>
  <canvas id="live2d" width="280" height="250" class="live2d"></canvas>
</div>
<script>
if( !/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)){
  document.write('<script type="text/javascript" src="/live2d/live2d.js"><\/script> <script type="text/javascript" src="/live2d/waifu-tips.js"><\/script>');
}
</script>

<!-- 打字礼花及震动特效 -->
<script>
if( !/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)){
  document.write('<script type="text/javascript" src="/js/custom/activate-power-mode.js"><\/script>');
}
</script>
<script>
    POWERMODE.colorful = true; // ture 为启用礼花特效
    POWERMODE.shake = false; // false 为禁用震动特效
    document.body.addEventListener('input', POWERMODE);
</script>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-chevron-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://qianling.pw/sql/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="千灵夙赋">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="千灵">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          《SQL 基础教程》笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间 2020-03-17 21:10:36" itemprop="dateCreated datePublished" datetime="2020-03-17T21:10:36+08:00">2020-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间 2020-04-21 19:57:23" itemprop="dateModified" datetime="2020-04-21T19:57:23+08:00">2020-04-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" itemprop="url" rel="index">
                    <span itemprop="name">计算机科学</span>
                  </a>
                </span>
            </span>

          
            <span id="/sql/" class="post-meta-item leancloud_visitors" data-flag-title="《SQL 基础教程》笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数 </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
  <i class="far fa-comment"></i>
    <a title="valine" href="/sql/#valine-comments" itemprop="discussionUrl">
     评论数
      <span class="post-comments-count valine-comment-count" data-xid="/sql/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img data-src="/images/covers/181.jpg" alt=""></p>
<a id="more"></a>

<hr>
<p><strong><div class="center">SQL基础教程 / (日) MICK 著 ; 孙淼, 罗勇译. -- 2版 -- 北京 : 人民邮电出版社, 2017.6<br>（图灵程序设计丛书）<br>ISBN 978-7-115-45502-4</div></strong></p>
<div class="center"><a id="download" href="https://qianling.coding.net/api/share/download/e935adf7-2f6e-4a14-8e81-ec75e2373e58"><i class="fa fa-download"></i> SQL基础教程（第2版）</a></div>

<hr>
<h1 id="第0章-绪论——搭建SQL的学习环境"><a href="#第0章-绪论——搭建SQL的学习环境" class="headerlink" title="第0章　绪论——搭建SQL的学习环境"></a>第0章　绪论——搭建SQL的学习环境</h1><p>切断与 SQL 的连接</p>
<ul>
<li><code>\q</code></li>
<li><code>exit</code></li>
<li>关闭窗口</li>
</ul>
<h1 id="第1章-数据库和SQL"><a href="#第1章-数据库和SQL" class="headerlink" title="第1章　数据库和SQL"></a>第1章　数据库和SQL</h1><h2 id="1-1-数据库是什么"><a href="#1-1-数据库是什么" class="headerlink" title="1-1　数据库是什么"></a>1-1　数据库是什么</h2><p>数据库：Database, DB<br>数据库管理系统：Database Management System, DBMS<br>关系数据库管理系统：Relational Database Management System, RDBMS</p>
<p>大到银行账户的管理，小到手机的电话簿，社会的所有系统中都有数据库的身影。</p>
<p>我们通过计算机管理数据的时候，通常使用文本文件或者 Excel 那样的电子制表软件就可以完成了，非常简单，但也有不足：</p>
<ul>
<li>无法多人共享数据：当某个用户购买商品的时候，其他用户就无法购买了</li>
<li>无法提供操作大量数据所需的格式：不能瞬间从上百万数据中获取想要的数据</li>
<li>实现读写自动化需要编程能力</li>
<li>无法应对突发事故</li>
</ul>
<h2 id="1-2-数据库的结构"><a href="#1-2-数据库的结构" class="headerlink" title="1-2　数据库的结构"></a>1-2　数据库的结构</h2><p>二维表：类似 Excel 工作表、由行和列组成，用于管理数据。<br>字段：表的列，它代表了保存在表中的数据项目。<br>记录：表的行，它相当于一条数据。<br>单元格：行和列交汇的方格，一个单元格中只能输入一个数据。</p>
<p>关系数据库以行为单位读写数据。</p>
<p>为了防止重要数据被窃读或篡改，RDBMS 只允许注册用户接触数据库。这里的用户并不是指 Windows 等操作系统的注册用户，而是只能用于 RDBMS 的用户。RDBMS 允许注册多个用户。</p>
<h2 id="1-3-SQL概要"><a href="#1-3-SQL概要" class="headerlink" title="1-3　SQL概要"></a>1-3　SQL概要</h2><h3 id="SQL语句及其种类"><a href="#SQL语句及其种类" class="headerlink" title="SQL语句及其种类"></a>SQL语句及其种类</h3><p>SQL 用关键字、表名、列名等组合而成的一条语句来描述操作的内容。</p>
<p>关键字：指那些含义或使用方法已事先定义好的英语单词，存在包含“对表进行查询”或者“参考这个表”等各种意义的关键字。</p>
<p>SQL 根据功能不同可以分为三类：<br>DDL：Data Definition Language，数据定义语言。用来创建或者删除存储数据用的数据库以及数据库中的表等对象。</p>
<ul>
<li>CREATE： 创建数据库和表等对象</li>
<li>DROP： 删除数据库和表等对象</li>
<li>ALTER： 修改数据库和表等对象的结构</li>
</ul>
<p>DML：Data Manipulation Language，数据操纵语言。用来查询或者变更表中的记录。</p>
<ul>
<li>SELECT：查询表中的数据</li>
<li>INSERT：向表中插入新数据</li>
<li>UPDATE：更新表中的数据</li>
<li>DELETE：删除表中的数据</li>
</ul>
<p>DCL：Data Control Language，数据控制语言。用来确认或者取消对数据的变更。除此之外，还可以对 RDBMS 的用户有权限操作数据库中的对象（数据库表等）进行设定。</p>
<ul>
<li>COMMIT： 确认对数据库中的数据进行的变更</li>
<li>ROLLBACK： 取消对数据库中的数据进行的变更</li>
<li>GRANT： 赋予用户操作权限</li>
<li>REVOKE： 取消用户的操作权限</li>
</ul>
<p>实际使用的 SQL 语句有 90% 属于 DML，本书以 DML 为中心讲解。</p>
<h3 id="SQL的基本书写规则"><a href="#SQL的基本书写规则" class="headerlink" title="SQL的基本书写规则"></a>SQL的基本书写规则</h3><ol>
<li><p>SQL 语句要以分号（;）结尾。</p>
</li>
<li><p>SQL 语句不区分大小写，但是插入到表中的数据是区分大小写的。为便于理解，本书使用以下规则书写 SQL 语句：</p>
</li>
</ol>
<ul>
<li>关键字大写</li>
<li>表名的首字母大写</li>
<li>其余（列名等）小写</li>
</ul>
<ol start="3">
<li>常数的书写方式是固定的。在 SQL 语句中直接书写的字符串、日期或者数字等称为常数。书写方式如下所示：</li>
</ol>
<ul>
<li>SQL 语句中含有字符串的时候，需要像’abc’这样，使用单引号（’）将字符串括起来，用来标识这是一个字符串。</li>
<li>SQL 语句中含有日期的时候，同样需要使用单引号将其括起来。日期的格式有很多种（’26 Jan 2010’ 或者’10/01/26’等），本书统一使用’2010-01-26’这种’年-月-日’的格式。</li>
<li>在 SQL 语句中书写数字的时候，不需要使用任何符号标识，直接写成 1000 这样的数字即可。</li>
</ul>
<ol start="4">
<li>单词需要用半角空格或者换行来分隔，不能使用全角空格作为单词的分隔符。</li>
</ol>
<h2 id="1-4-表的创建"><a href="#1-4-表的创建" class="headerlink" title="1-4　表的创建"></a>1-4　表的创建</h2><h3 id="数据库和表的创建"><a href="#数据库和表的创建" class="headerlink" title="数据库和表的创建"></a>数据库和表的创建</h3><p>创建数据库：<code>CREATE DATABASE &lt;数据库名称&gt;;</code><br>创建表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> &lt;表名&gt;</span><br><span class="line">（&lt;列名<span class="number">1</span>&gt; &lt;数据类型&gt; &lt;该列所需约束&gt;，</span><br><span class="line">&lt;列名<span class="number">2</span>&gt; &lt;数据类型&gt; &lt;该列所需约束&gt;，</span><br><span class="line">&lt;列名<span class="number">3</span>&gt; &lt;数据类型&gt; &lt;该列所需约束&gt;，</span><br><span class="line">&lt;列名<span class="number">4</span>&gt; &lt;数据类型&gt; &lt;该列所需约束&gt;，</span><br><span class="line">……</span><br><span class="line">&lt;该表的约束<span class="number">1</span>&gt;, &lt;该表的约束<span class="number">2</span>&gt;,……）；</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Product</span><br><span class="line">(product_id      <span class="built_in">CHAR</span>(<span class="number">4</span>)       <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> product_name    <span class="built_in">VARCHAR</span>(<span class="number">100</span>)  <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> product_type    <span class="built_in">VARCHAR</span>(<span class="number">32</span>)   <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> sale_price      <span class="built_in">INTEGER</span>       ,</span><br><span class="line"> purchase_price  <span class="built_in">INTEGER</span>       ,</span><br><span class="line"> regist_date     <span class="built_in">DATE</span>          ,</span><br><span class="line"> PRIMARY <span class="keyword">KEY</span> (product_id));</span><br></pre></td></tr></table></figure>

<h3 id="命名规则"><a href="#命名规则" class="headerlink" title="命名规则"></a>命名规则</h3><ul>
<li>数据库名称、表名以及列名只能使用半角英文字母、数字、下划线</li>
<li>名称必须以半角英文字母开头</li>
<li>名称不能重复</li>
</ul>
<h3 id="数据类型的指定"><a href="#数据类型的指定" class="headerlink" title="数据类型的指定"></a>数据类型的指定</h3><p>数据类型表示数据的种类，包括数字型、字符型和日期型等。</p>
<p>字节是计算机内部的数据单位。<br>一个字符通常需要 1 到 3 个字节来表示（根据字符的种类和表现方式有所不同）。</p>
<p>学习 SQL 的时候，使用最基本的数据类型就足够了：</p>
<ul>
<li>INTEGER 型：用来指定存储整数的列的数据类型（数字型），不能存储小数。</li>
<li>CHAR 型：CHARACTER（字符）的缩写，是用来指定存储字符串的列的数据类型（字符型）。可以像<code>CHAR(10)</code>这样，指定该列可以存储的字符串的长度（最大长度）;字符串以定长字符串的形式存储在被指定为 CHAR 型的列中。所谓定长字符串，就是当列中存储的字符串长度达不到最大长度的时候，使用半角空格补足。向<code>CHAR(8)</code>类型的列中输入<code>&#39;abc&#39;</code>的时候，会以 abc 后面有 5 个半角空格的形式保存起来。</li>
<li>VARCHAR 型：VAR 是 VARING（可变的）的缩写。同 CHAR 类型一样，但该类型的列是以可变长字符串的形式来保存字符串的，即使字符数未达到最大长度，也不会用半角空格补足。</li>
<li>DATE 型：用来指定存储日期（年月日）的列的数据类型（日期型）。</li>
</ul>
<h3 id="约束的设置"><a href="#约束的设置" class="headerlink" title="约束的设置"></a>约束的设置</h3><p>约束是除了数据类型之外，对列中存储的数据进行限制或者追加条件<br>的功能。Product 表中设置了两种约束。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">product_id CHAR(4) NOT NULL,</span><br><span class="line">product_name VARCHAR(100) NOT NULL,</span><br><span class="line">product_type VARCHAR(32) NOT NULL,</span><br></pre></td></tr></table></figure>
<p><code>NULL</code>是代表空白（无记录）的关键字。在<code>NULL</code>之前加上了表示否定的<code>NOT</code>，就是给该列设置了不能输入空白，也就是必须输入数据的约束（如果什么都不输入就会出错）。</p>
<p><code>PRIMARY KEY (product_id)</code><br>这是用来给<code>product_id</code>列设置主键约束的。所谓键，就是在指定特定数据时使用的列的组合。键种类多样，主键（primary key）就是可以特定一行数据的列。也就是说，如果把<code>product_id</code>列指定为主键，就可以通过该列取出特定的商品数据了。</p>
<h2 id="1-5-表的删除和更新"><a href="#1-5-表的删除和更新" class="headerlink" title="1-5　表的删除和更新"></a>1-5　表的删除和更新</h2><p>表的删除：<code>DROP TABLE &lt;表名&gt;；</code></p>
<p>表定义的更新:</p>
<ul>
<li>添加列<code>ALTER TABLE &lt;表名&gt; ADD COLUMN &lt;列名&gt; &lt;数据类型&gt; &lt;该列所需约束&gt;；</code></li>
<li>删除列<code>ALTER TABLE &lt;表名&gt; DROP COLUMN &lt;列名&gt;；</code></li>
</ul>
<p>向表中插入数据：<code>INSERT INTO &lt;表名&gt; (可选字段名, …) VALUES (&lt;value1&gt;, …);</code>　字段顺序不必与表顺序一致。如字段有默认值，可不写。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Product <span class="keyword">VALUES</span> (<span class="string">'0001'</span>, <span class="string">'T恤衫'</span>, <span class="string">'衣服'</span>, <span class="number">1000</span>, <span class="number">500</span>, <span class="string">'2009-09-20'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Product <span class="keyword">VALUES</span> (<span class="string">'0002'</span>, <span class="string">'打孔器'</span>, <span class="string">'办公用品'</span>, <span class="number">500</span>, <span class="number">320</span>, <span class="string">'2009-09-11'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Product <span class="keyword">VALUES</span> (<span class="string">'0003'</span>, <span class="string">'运动T恤'</span>, <span class="string">'衣服'</span>, <span class="number">4000</span>, <span class="number">2800</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Product <span class="keyword">VALUES</span> (<span class="string">'0004'</span>, <span class="string">'菜刀'</span>, <span class="string">'厨房用具'</span>, <span class="number">3000</span>, <span class="number">2800</span>, <span class="string">'2009-09-20'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Product <span class="keyword">VALUES</span> (<span class="string">'0005'</span>, <span class="string">'高压锅'</span>, <span class="string">'厨房用具'</span>, <span class="number">6800</span>, <span class="number">5000</span>, <span class="string">'2009-01-15'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Product <span class="keyword">VALUES</span> (<span class="string">'0006'</span>, <span class="string">'叉子'</span>, <span class="string">'厨房用具'</span>, <span class="number">500</span>, <span class="literal">NULL</span>, <span class="string">'2009-09-20'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Product <span class="keyword">VALUES</span> (<span class="string">'0007'</span>, <span class="string">'擦菜板'</span>, <span class="string">'厨房用具'</span>, <span class="number">880</span>, <span class="number">790</span>, <span class="string">'2008-04-28'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Product <span class="keyword">VALUES</span> (<span class="string">'0008'</span>, <span class="string">'圆珠笔'</span>, <span class="string">'办公用品'</span>, <span class="number">100</span>, <span class="literal">NULL</span>, <span class="string">'2009-11-11'</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>开头的<code>BEGIN TRANSACTION</code>语句是开始插入行的指令语句，结尾的<code>COMMIT</code>语句是确定插入行的指令语句。这些指令语句将会在第 4 章详细介绍，不必急于记住这些语句。</p>
<p>变更表名：<code>RENAME TABLE &lt;变更前的名称&gt; to &lt;变更后的名称&gt;;</code></p>
<h1 id="第2章-查询基础"><a href="#第2章-查询基础" class="headerlink" title="第2章　查询基础"></a>第2章　查询基础</h1><h2 id="2-1-SELECT语句基础"><a href="#2-1-SELECT语句基础" class="headerlink" title="2-1　SELECT语句基础"></a>2-1　SELECT语句基础</h2><p>　　从表中选取数据时需要使用<code>SELECT</code>语句，也就是只从表中选出必要数据的意思。通过<code>SELECT</code>语句查询并选取出必要数据的过程称为匹配查询或查询（query）。<br>　　<code>SELECT</code>语句是 SQL 语句中使用最多的最基本的 SQL 语句。掌握了<code>SELECT</code>语句，距离掌握 SQL 语句就不远了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> &lt;列名&gt;, ……</span><br><span class="line">  <span class="keyword">FROM</span> &lt;表名&gt;；</span><br></pre></td></tr></table></figure>
<p>　　该<code>SELECT</code>语句包含了<code>SELECT</code>和<code>FROM</code>两个子句（clause） 。<br>　　子句：以<code>SELECT</code>或者<code>FROM</code>等作为起始的短语。<br>　　<code>SELECT</code>子句中列举了希望从表中查询出的列的名称，而<code>FROM</code>子句则指定了选取出数据的表的名称。<br>　　查询结果中列的顺序和<code>SELECT</code>子句中的顺序相同。</p>
<p>　　查询全部的列：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line">  <span class="keyword">FROM</span> &lt;表名&gt;;</span><br></pre></td></tr></table></figure>
<p>　　如果使用星号的话，就无法设定列的显示顺序了 。这时就会按照<code>CREATE TABLE</code>语句的定义对列进行排序。</p>
<p>　　SQL 语句使用换行符或者半角空格来分隔单词，在任何位置进行分隔都可以，即使像下面这样通篇都是换行符也不会影响<code>SELECT</code>语句的执行。但是这样可能会由于看不清楚而出错。原则上希望大家能够以子句为单位进行换行（子句过长时，为方便起见可以换行）。另外，插入空行（无任何字符的行）会造成执行错误。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">* <span class="keyword">FROM</span></span><br><span class="line">Product</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>　　为列设定别名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_id <span class="keyword">AS</span> <span class="keyword">id</span>,</span><br><span class="line">product_name <span class="keyword">AS</span> <span class="keyword">name</span>,</span><br><span class="line">purchase_price <span class="keyword">AS</span> price</span><br><span class="line"><span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>
<p>　　<code>AS</code>可省略，使用中文时需要用双引号（”）括起来</p>
<p>　　常数的查询：<br>　　<code>SELECT</code>子句中不仅可以书写列名，还可以书写常数。下列代码<code>SELECT</code>子句中的第一列<code>&#39;商品&#39;</code>是字符串常数，第 2 列<code>38</code>是数字常数 ，第 3 列<code>&#39;2009-02-24&#39;</code>是日期常数，它们将与<code>product_id</code>列和<code>product_name</code>列一起被查询出来。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">'商品'</span> <span class="keyword">AS</span> <span class="keyword">string</span>, <span class="number">38</span> <span class="keyword">AS</span> <span class="built_in">number</span>, <span class="string">'2009-02-24'</span> <span class="keyword">AS</span> <span class="built_in">date</span>, product_id, product_name</span><br><span class="line"><span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">| string | number | date       | product_id | product_name</span><br><span class="line">+<span class="comment">--------+--------+------------+------------+--------------</span></span><br><span class="line">| 商品   |     38 | 2009-02-24 | 0001       | T恤衫</span><br><span class="line">| 商品   |     38 | 2009-02-24 | 0002       | 打孔器</span><br><span class="line">| 商品   |     38 | 2009-02-24 | 0003       | 运动T恤</span><br><span class="line">| 商品   |     38 | 2009-02-24 | 0004       | 菜刀</span><br><span class="line">| 商品   |     38 | 2009-02-24 | 0005       | 高压锅</span><br><span class="line">| 商品   |     38 | 2009-02-24 | 0006       | 叉子</span><br><span class="line">| 商品   |     38 | 2009-02-24 | 0007       | 擦菜板</span><br><span class="line">| 商品   |     38 | 2009-02-24 | 0008       | 圆珠笔</span><br></pre></td></tr></table></figure>

<p>　　删除重复行：想知道表中保存了哪些商品种类。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> product_type <span class="string">"商品种类"</span></span><br><span class="line">  <span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>

<p>　　选择记录：选取出满足某些条件的数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> &lt;列名&gt;, ……</span><br><span class="line">  <span class="keyword">FROM</span> &lt;表名&gt;</span><br><span class="line"> <span class="keyword">WHERE</span> &lt;条件表达式&gt;;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, product_type</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> product_type = <span class="string">'衣服'</span>;</span><br></pre></td></tr></table></figure>

<p>　　首先通过<code>WHERE</code>子句查询出符合指定条件的记录，然后再选取出<code>SELECT</code>语句指定的列。</p>
<p>　　SQL 中子句的书写顺序是固定的，不能随意更改。</p>
<p>　　单行注释：<code>--</code><br>　　多行注释：<code>/*…*/</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> product_id, purchase_price</span><br><span class="line"><span class="comment">/* 本SELECT语句，</span></span><br><span class="line"><span class="comment">   会从结果中删除重复行。*/</span></span><br><span class="line">  <span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-算术运算符和比较运算符"><a href="#2-2-算术运算符和比较运算符" class="headerlink" title="2-2　算术运算符和比较运算符"></a>2-2　算术运算符和比较运算符</h2><h3 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h3><p>　　SQL 语句中可以使用计算表达式。<br>　　四则运算所使用的运算符（+、-、*、/）称为算术运算符。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, sale_price,</span><br><span class="line">       sale_price * <span class="number">2</span> <span class="keyword">AS</span> <span class="string">"sale_price_x2"</span></span><br><span class="line">  <span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>

<p>　　SQL 中也可以使用括号()。括号中运算表达式的优先级会得到提升，优先进行运算。<br>　　括号的使用并不仅仅局限于四则运算，还可以用在 SQL 语句的任何表达式当中。具体的使用方法今后会慢慢介绍给大家。</p>
<p>　　NULL 的运算结果都为<code>NULL</code>。</p>
<h3 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">运算符      含义</span><br><span class="line">=          和～相等</span><br><span class="line">&lt;&gt;         和～不相等</span><br><span class="line">&gt;=         大于等于～</span><br><span class="line">&gt;          大于～</span><br><span class="line">&lt;=         小于等于～</span><br><span class="line">&lt;          小于～</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, product_type, regist_date</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> regist_date &lt; <span class="string">'2009-09-27'</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, sale_price, purchase_price</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> sale_price - purchase_price &gt;= <span class="number">500</span>;</span><br></pre></td></tr></table></figure>

<p>　　字符串类型的数据原则上按照字典顺序进行排序，不能与数字的大小顺序混淆。以相同字符开头的单词比不同字符开头的单词更相近。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">2</span><br><span class="line">222</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<p>　　比较运算符结果中没有<code>NULL</code>数据。</p>
<p>　　选取<code>NULL</code>数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, purchase_price</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> purchase_price <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-逻辑运算符"><a href="#2-3-逻辑运算符" class="headerlink" title="2-3　逻辑运算符"></a>2-3　逻辑运算符</h2><h3 id="NOT-运算符"><a href="#NOT-运算符" class="headerlink" title="NOT 运算符"></a>NOT 运算符</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, product_type, sale_price</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> <span class="keyword">NOT</span> sale_price &gt;= <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>
<p>　　效果等价于 <code>&lt; 1000</code>，但不直观，它用来否定某一条件，不能滥用。</p>
<h3 id="AND-运算符和-OR-运算符"><a href="#AND-运算符和-OR-运算符" class="headerlink" title="AND 运算符和 OR 运算符"></a>AND 运算符和 OR 运算符</h3><p>AND 运算符在其两侧的查询条件都成立时整个查询条件才成立，其意思相当于“并且”。<br>OR 运算符在其两侧的查询条件有一个成立时整个查询条件都成立，其意思相当于“或者”。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, purchase_price</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> product_type = <span class="string">'厨房用具'</span></span><br><span class="line">    <span class="keyword">OR</span> sale_price &gt;= <span class="number">3000</span>;</span><br></pre></td></tr></table></figure>

<p>　　文氏图：将集合（事物的聚集）的关系通过更加容易理解的图形进行可视化展示。</p>
<p>　　AND 运算符的优先级高于 OR 运算符。想要优先执行 OR 运算符时可以使用括号。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, product_type, regist_date</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> product_type = <span class="string">'办公用品'</span></span><br><span class="line">   <span class="keyword">AND</span> (   regist_date = <span class="string">'2009-09-11'</span></span><br><span class="line">        <span class="keyword">OR</span> regist_date = <span class="string">'2009-09-20'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="逻辑运算符和真值"><a href="#逻辑运算符和真值" class="headerlink" title="逻辑运算符和真值"></a>逻辑运算符和真值</h3><p>　　NOT、AND 和 OR 称为逻辑运算符。这里所说的逻辑就是对真值进行操作的意思。真值就是值为真（TRUE）或假（FALSE）其中之一的值。<br>　　上一节介绍的比较运算符会把运算结果以真值的形式进行返回。比较结果成立时返回真（TRUE），比较结果不成立时返回假（FALSE）。例如，对于<code>sale_price &gt;= 3000</code>这个查询条件来说，由于<code>product_name</code>列为<code>&#39;运动T恤&#39;</code>的记录的<code>sale_price</code>列的值是<code>2800</code>，因此会返回假（FALSE），而<code>product_name</code>列为’高压锅’的记录的<code>sale_price</code>列的值是<code>5000</code>，所以返回真（TRUE）。<br>　　逻辑运算符对比较运算符等返回的真值进行操作。AND 运算符两侧的真值都为真时返回真，除此之外都返回假。OR 运算符两侧的真值只要有一个不为假就返回真，只有当其两侧的真值都为假时才返回假。NOT 运算符只是单纯的将真转换为假，将假转换为真。<br>　　使用 AND 运算符进行的逻辑运算称为逻辑积，使用 OR 运算符进行的逻辑运算称为逻辑和。</p>
<h1 id="第3章-聚合与排序"><a href="#第3章-聚合与排序" class="headerlink" title="第3章　聚合与排序"></a>第3章　聚合与排序</h1><h2 id="3-1-对表进行聚合查询"><a href="#3-1-对表进行聚合查询" class="headerlink" title="3-1　对表进行聚合查询"></a>3-1　对表进行聚合查询</h2><h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><p>　　通过 SQL 对数据进行某种操作或计算时需要使用函数。</p>
<ul>
<li>COUNT： 计算表中的记录数（行数）</li>
<li>SUM：   计算表中数值列中数据的合计值</li>
<li>AVG：   计算表中数值列中数据的平均值</li>
<li>MAX：   求出表中任意列中数据的最大值</li>
<li>MIN：   求出表中任意列中数据的最小值</li>
</ul>
<p>　　用于汇总的函数称为聚合函数。聚合，就是将多行汇总为一行。</p>
<p>　　计算全部数据的行数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*)</span><br><span class="line">  <span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>

<p>　　此处的输入值称为参数或者 parameter，输出值称为返回值。<br>　　<br>　　COUNT 函数的结果根据参数的不同而不同。<code>COUNT(*)</code>会得到包含 NULL 的数据行数，而<code>COUNT(&lt;列名&gt;)</code>会得到 NULL 之外的数据行数。<br>　　其他函数并不能将星号作为参数，该特性是 COUNT 函数所特有的。<br>　　聚合函数会将<code>NULL</code>排除在外。但<code>COUNT(*)</code>例外，并不会排除<code>NULL</code>。</p>
<p>　　计算毛利润：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(sale_price - purchase_price)</span><br><span class="line">  <span class="keyword">FROM</span> Product;</span><br><span class="line"><span class="comment">/* 下面的语句会因 NULL 值造成误差</span></span><br><span class="line"><span class="comment">SUM(sale_price) - SUM(purchase_price)*/</span></span><br></pre></td></tr></table></figure>

<p>　　计算平均销售价格：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(sale_price)</span><br><span class="line">  <span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>

<p>　　计算销售价格极差：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(sale_price) - <span class="keyword">MIN</span>(sale_price)</span><br><span class="line">  <span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>

<p>　　MAX/MIN 函数几乎适用于所有数据类型的列。SUM/AVG 函数只适用于数值类型的列。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(regist_date), <span class="keyword">MIN</span>(regist_date)</span><br><span class="line">  <span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>

<p>　　使用聚合函数删除重复值，计算值的种类：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> product_type)</span><br><span class="line">  <span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-对表分组"><a href="#3-2-对表分组" class="headerlink" title="3-2　对表分组"></a>3-2　对表分组</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> &lt;列名<span class="number">1</span>&gt;, &lt;列名<span class="number">2</span>&gt;, &lt;列名<span class="number">3</span>&gt;, ……</span><br><span class="line">  <span class="keyword">FROM</span> &lt;表名&gt;</span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> &lt;列名<span class="number">1</span>&gt;, &lt;列名<span class="number">2</span>&gt;, &lt;列名<span class="number">3</span>&gt;, ……;</span><br></pre></td></tr></table></figure>
<p>　　按照商品种类统计数据行数：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_type, <span class="keyword">COUNT</span>(*)</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_type;</span><br></pre></td></tr></table></figure>

<p>　　GROUP BY 子句中指定的列称为聚合键或者分组列，能够决定表的切分方式。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> purchase_price, <span class="keyword">COUNT</span>(*)</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> product_type = <span class="string">'衣服'</span></span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> purchase_price;</span><br></pre></td></tr></table></figure>
<p>　　GROUP BY 和 WHERE 并用时SELECT 语句的执行顺序：<code>FROM → WHERE → GROUP BY → SELECT</code></p>
<p>　　在使用 COUNT 这样的聚合函数时，SELECT 子句中的元素有严格<br>的限制，只能存在以下三种元素：</p>
<ul>
<li>常数</li>
<li>聚合函数</li>
<li>GROUP BY 子句中指定的列名（也就是聚合键）</li>
</ul>
<p>　　通过某个聚合键将表分组之后，结果中的一行数据就代表一组。例如，使用进货单价将表进行分组之后，一行就代表了一个进货单价。问题就出在这里，聚合键和商品名并不一定是一对一的。<br>　　例如，进货单价是 2800 日元的商品有“运动 T 恤”和“菜刀”两种，但是 2800 日元这一行应该对应哪个商品名呢？像这样与聚合键相对应的、同时存在多个值的列出现在 SELECT 子句中的情况，理论上是不可能的。</p>
<p>　　GROUP BY 子句中不能使用别名。<br>　　GROUP BY 子句结果的显示是无序的。<br>　　只有 SELECT 子句、HAVING 子句、ORDER BY 子句中能使用聚合函数。</p>
<h2 id="3-3-为聚合结果指定条件"><a href="#3-3-为聚合结果指定条件" class="headerlink" title="3-3　为聚合结果指定条件"></a>3-3　为聚合结果指定条件</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> &lt;列名<span class="number">1</span>&gt;, &lt;列名<span class="number">2</span>&gt;, &lt;列名<span class="number">3</span>&gt;, ……</span><br><span class="line">  <span class="keyword">FROM</span> &lt;表名&gt;</span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> &lt;列名<span class="number">1</span>&gt;, &lt;列名<span class="number">2</span>&gt;, &lt;列名<span class="number">3</span>&gt;, ……</span><br><span class="line"><span class="keyword">HAVING</span> &lt;分组结果对应的条件&gt;</span><br></pre></td></tr></table></figure>
<p>　　HAVING 子句必须写在 GROUP BY 子句之后。</p>
<p>　　查询销售单价的平均值大于等于 2500 日元的商品种类</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_type, <span class="keyword">AVG</span>(sale_price)</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_type</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">AVG</span>(sale_price) &gt;= <span class="number">2500</span>;</span><br></pre></td></tr></table></figure>

<p>　　HAVING 子句中能够使用的 3 种要素：</p>
<ul>
<li>常数</li>
<li>聚合函数</li>
<li>GROUP BY 子句中指定的列名（也就是聚合键）</li>
</ul>
<h2 id="3-4-对查询结果进行排序"><a href="#3-4-对查询结果进行排序" class="headerlink" title="3-4　对查询结果进行排序"></a>3-4　对查询结果进行排序</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> &lt;列名<span class="number">1</span>&gt;, &lt;列名<span class="number">2</span>&gt;, &lt;列名<span class="number">3</span>&gt;, ……</span><br><span class="line">  <span class="keyword">FROM</span> &lt;表名&gt;</span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> &lt;排序基准列<span class="number">1</span>&gt;, &lt;排序基准列<span class="number">2</span>&gt;, ……</span><br></pre></td></tr></table></figure>
<p>　　降序在列名后加上<code>DESC</code>关键字。<br>　　在<code>ORDER BY</code>子句中可以使用<code>SELECT</code>子句中定义的别名。<br>　　使用<code>HAVING</code>子句时<code>SELECT</code>语句的顺序<br><code>FROM → WHERE → GROUP BY → HAVING → SELECT → ORDER BY</code></p>
<p>　　在<code>ORDER BY</code>子句中可以使用<code>SELECT</code>子句中未使用的列和聚合函数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_type, <span class="keyword">COUNT</span>(*)</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_type</span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">COUNT</span>(*);</span><br></pre></td></tr></table></figure>

<h1 id="第4章-数据更新"><a href="#第4章-数据更新" class="headerlink" title="第4章　数据更新"></a>第4章　数据更新</h1><h2 id="4-1-数据的插入（INSERT语句的使用方法）"><a href="#4-1-数据的插入（INSERT语句的使用方法）" class="headerlink" title="4-1　数据的插入（INSERT语句的使用方法）"></a>4-1　数据的插入（INSERT语句的使用方法）</h2><p><code>INSERT INTO &lt;表名&gt; (列1, 列2, 列3, ……) VALUES (值1, 值2, 值3, ……);</code></p>
<p><code>INSERT INTO ProductIns (product_id, product_name, product_type, sale_price, purchase_price, regist_date) VALUE (&#39;0001&#39;, &#39;T恤衫&#39;, &#39;衣服&#39;, 1000, 500, &#39;2009-09-20&#39;);</code><br>　　字符型、日期型需要用单引号括起来。<br>　　将列名和值用逗号隔开，分别括在（）内，这种形式称为清单。代码的 INSERT 语句包含如下两个清单：<br>　　列清单→<code>(product_id, product_name, product_type,
sale_price, purchase_price, regist_date)</code><br>　　值清单→<code>(&#39;0001&#39;, &#39;T恤衫&#39;, &#39;衣服&#39;, 1000, 500,&#39;2009-09-20&#39;)</code></p>
<p>　　全列 INSERT 时，可以省略表名后的列清单。这时 VALUES 子句的值会默认按照从左到右的顺序赋给每一列。</p>
<p>　　多行 INSERT：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ProductIns <span class="keyword">VALUES</span> (<span class="string">'0002'</span>, <span class="string">'打孔器'</span>, <span class="string">'办公用品'</span>, <span class="number">500</span>, <span class="number">320</span>, <span class="string">'2009-09-11'</span>),</span><br><span class="line">                              (<span class="string">'0003'</span>, <span class="string">'运动T恤'</span>, <span class="string">'衣服'</span>, <span class="number">4000</span>, <span class="number">2800</span>, <span class="literal">NULL</span>),</span><br><span class="line">                              (<span class="string">'0004'</span>, <span class="string">'菜刀'</span>, <span class="string">'厨房用具'</span>, <span class="number">3000</span>, <span class="number">2800</span>, <span class="string">'2009-09-20'</span>);</span><br></pre></td></tr></table></figure>

<p>　　插入默认值：设定默认值，就可以在 INSERT 语句中自动为列赋值了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> ProductIns</span><br><span class="line">(product_id <span class="built_in">CHAR</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"> （略）</span><br><span class="line"> sale_price <span class="built_in">INTEGER</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>, <span class="comment">-- 销售单价的默认值设定为0;</span></span><br><span class="line"> （略）</span><br><span class="line"> PRIMARY <span class="keyword">KEY</span> (product_id));</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ProductIns (product_id, product_name, product_type, sale_price, purchase_price, regist_date) <span class="keyword">VALUES</span> (<span class="string">'0007'</span>, <span class="string">'擦菜板'</span>, <span class="string">'厨房用具'</span>, <span class="keyword">DEFAULT</span>, <span class="number">790</span>, <span class="string">'2009-04-28'</span>);</span><br></pre></td></tr></table></figure>

<p>　　从其它表中复制数据：可以在需要备份数据时使用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ProductCopy (product_id, product_name, product_type, </span><br><span class="line">sale_price, purchase_price, regist_date)</span><br><span class="line"><span class="keyword">SELECT</span> product_id, product_name, product_type, sale_price, </span><br><span class="line">purchase_price, regist_date</span><br><span class="line"><span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>
<p>　　目前为止学到的各种 SELECT 语句都可以使用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ProductType (product_type, sum_sale_price, sum_purchase_price)</span><br><span class="line"><span class="keyword">SELECT</span> product_type, <span class="keyword">SUM</span>(sale_price), <span class="keyword">SUM</span>(purchase_price)</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_type;</span><br></pre></td></tr></table></figure>

<h2 id="4-2-数据的删除（DELETE语句的使用方法）"><a href="#4-2-数据的删除（DELETE语句的使用方法）" class="headerlink" title="4-2　数据的删除（DELETE语句的使用方法）"></a>4-2　数据的删除（DELETE语句的使用方法）</h2><p>① <code>DROP TABLE</code> 语句可以将表完全删除<br>② <code>TRUNCATE &lt;表名&gt;;</code> 删除表中的全部数据，不能指定条件，比 DELETE 快<br>③ <code>DELETE FROM &lt;表名&gt;;</code> 删除表中的全部数据，可指定条件</p>
<p>　　指定删除对象：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> &lt;表名&gt;</span><br><span class="line"> <span class="keyword">WHERE</span> &lt;条件&gt;;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> sale_price &gt;= <span class="number">4000</span>;</span><br></pre></td></tr></table></figure>

<h2 id="4-3-数据的更新（UPDATE语句的使用方法）"><a href="#4-3-数据的更新（UPDATE语句的使用方法）" class="headerlink" title="4-3　数据的更新（UPDATE语句的使用方法）"></a>4-3　数据的更新（UPDATE语句的使用方法）</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> &lt;表名&gt;</span><br><span class="line">   <span class="keyword">SET</span> &lt;列名&gt; = &lt;表达式&gt;;</span><br><span class="line"> WHERE &lt;条件&gt;;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Product</span><br><span class="line">   <span class="keyword">SET</span> regist_date = <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Product</span><br><span class="line">   <span class="keyword">SET</span> sale_price = sale_price * <span class="number">10</span>,</span><br><span class="line">       purchase_price = purchase_price / <span class="number">2</span></span><br><span class="line"> <span class="keyword">WHERE</span> product_type = <span class="string">'厨房用具'</span>;</span><br></pre></td></tr></table></figure>

<h2 id="4-4-事务"><a href="#4-4-事务" class="headerlink" title="4-4　事务"></a>4-4　事务</h2><p>　　事务（transaction）是需要在同一个处理单元中执行的一系列更新处理的集合。通过使用事务，可以对数据库中的数据更新处理的提交和取消进行管理。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>; <span class="comment">-- 可以省略</span></span><br><span class="line">DML语句①;</span><br><span class="line">DML语句②;</span><br><span class="line">DML语句③;</span><br><span class="line">……</span><br><span class="line"><span class="keyword">COMMIT</span>; / <span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line">    <span class="comment">-- 将运动T恤的销售单价降低1000日元</span></span><br><span class="line">    <span class="keyword">UPDATE</span> Product</span><br><span class="line">       <span class="keyword">SET</span> sale_price = sale_price - <span class="number">1000</span></span><br><span class="line">     <span class="keyword">WHERE</span> product_name = <span class="string">'运动T恤'</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 将T恤衫的销售单价上浮1000日元</span></span><br><span class="line">    <span class="keyword">UPDATE</span> Product</span><br><span class="line">       <span class="keyword">SET</span> sale_price = sale_price + <span class="number">1000</span></span><br><span class="line">     <span class="keyword">WHERE</span> product_name = <span class="string">'T恤衫'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>　　ACID 特性：</p>
<ul>
<li>原子性（Atomicity）：原子性是指在事务结束时，其中所包含的更新处理要么全部执行，要么完全不执行，也就是要么占有一切要么一无所有。</li>
<li>一致性（Consistency）：一致性也称为完整性，指的是事务中包含的处理要满足数据库提前设置的约束，如主键约束或者 NOT NULL 约束等。</li>
<li>隔离性（Isolation）：保证不同事务之间互不干扰的特性。该特性保证了事务之间不会互相嵌套。即使某个事务向表中添加了记录，在没有提交之前，其他事务也是看不到新添加的记录的。</li>
<li>持久性（Durability）：在事务结束后，DBMS 能够保证该时间点的数据状态会被保存的特性。即使由于系统故障导致数据丢失，数据库也一定能通过某种手段恢复。</li>
</ul>
<h1 id="第5章-复杂查询"><a href="#第5章-复杂查询" class="headerlink" title="第5章　复杂查询"></a>第5章　复杂查询</h1><h2 id="5-1-视图"><a href="#5-1-视图" class="headerlink" title="5-1　视图"></a>5-1　视图</h2><p>　　视图和表的结果相同，区别在于表中保存的是实际的数据，而视图中保存的是 SELECT 语句（视图本身并不存储数据）。<br>　　实际上，在 SQL 语句中并不需要区分哪些是表，哪些是视图，只需要知道在更新时它们之间存在一些不同就可以了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 视图名称(&lt;视图列名<span class="number">1</span>&gt;, &lt;视图列名<span class="number">2</span>&gt;, ……)</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">&lt;<span class="keyword">SELECT</span>语句&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_type, cnt_product</span><br><span class="line">  <span class="keyword">FROM</span> ProductSum;</span><br></pre></td></tr></table></figure>

<p>　　定义视图时不要使用<code>ORDER BY</code>子句。</p>
<p>　　可以更新的视图：既没有聚合又没有结合的 SELECT 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> ProductJim (product_id, product_name, product_type, sale_price, purchase_price, regist_date)</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> product_type = <span class="string">'办公用品'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> ProductJim <span class="keyword">VALUES</span> (<span class="string">'0009'</span>, <span class="string">'印章'</span>, <span class="string">'办公用品'</span>, <span class="number">95</span>, <span class="number">10</span>, <span class="string">'2009-11-30'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="5-2-子查询"><a href="#5-2-子查询" class="headerlink" title="5-2　子查询"></a>5-2　子查询</h2><p>　　子查询就是一次性视图（SELECT语句），在 SELECT 语句执行完毕之后消失。<br>　　尽量避免使用多层嵌套的子查询。<br>　　子查询必须设定名称，<code>AS</code>关键字可省略。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_type, cnt_product</span><br><span class="line">  <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> *</span><br><span class="line">          <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> product_type, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> cnt_product</span><br><span class="line">                  <span class="keyword">FROM</span> Product</span><br><span class="line">                 <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_type) <span class="keyword">AS</span> ProductSum</span><br><span class="line">         <span class="keyword">WHERE</span> cnt_product = <span class="number">4</span>) <span class="keyword">AS</span> ProductSum2;</span><br></pre></td></tr></table></figure>

<p>　　标量是单一的意思。<br>　　标量子查询是返回单一值的子查询，只能返回 1 行 1 列的结果。<br>　　几乎所有的地方都可以使用。<br>　　选取出销售单价高于全部商品的平均单价的商品：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_id, product_name, sale_price</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> sale_price &gt; (<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(sale_price)</span><br><span class="line">                     <span class="keyword">FROM</span> Product);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_id,</span><br><span class="line">       product_name,</span><br><span class="line">       sale_price,</span><br><span class="line">       (<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(sale_price)</span><br><span class="line">          <span class="keyword">FROM</span> Product) <span class="keyword">AS</span> avg_price</span><br><span class="line">  <span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><figcaption><span>选取按商品种类计算的销售单价高于全部商品平均销售单价的商品种类</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_type, <span class="keyword">AVG</span>(sale_price)</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_type</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">AVG</span>(sale_price) &gt; (<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(sale_price)</span><br><span class="line">                            <span class="keyword">FROM</span> Product);</span><br></pre></td></tr></table></figure>

<h2 id="5-3-关联子查询"><a href="#5-3-关联子查询" class="headerlink" title="5-3　关联子查询"></a>5-3　关联子查询</h2><p>　　使用关联子查询时，需要在表所对应的列名之前加上表的别名，<code>&lt;表名&gt;.&lt;列名&gt;</code></p>
<figure class="highlight sql"><figcaption><span>通过关联子查询按照商品种类对平均销售单价进行比较</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_type, product_name, sale_price</span><br><span class="line">  <span class="keyword">FROM</span> Product <span class="keyword">AS</span> P1</span><br><span class="line"> <span class="keyword">WHERE</span> sale_price &gt; (<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(sale_price)</span><br><span class="line">                       <span class="keyword">FROM</span> Product <span class="keyword">AS</span> P2</span><br><span class="line">                      <span class="keyword">WHERE</span> P1.product_type = P2.product_type</span><br><span class="line">                      <span class="keyword">GROUP</span> <span class="keyword">BY</span> product_type);</span><br></pre></td></tr></table></figure>

<h1 id="第6章-函数、谓词、CASE表达式"><a href="#第6章-函数、谓词、CASE表达式" class="headerlink" title="第6章　函数、谓词、CASE表达式"></a>第6章　函数、谓词、CASE表达式</h1><h2 id="6-1-各种各样的函数"><a href="#6-1-各种各样的函数" class="headerlink" title="6-1　各种各样的函数"></a>6-1　各种各样的函数</h2><p>　　所谓函数，就是输入某一值得到相应输出结果的功能，输入值称为参数（parameter），输出值称为返回值。</p>
<h3 id="算数函数"><a href="#算数函数" class="headerlink" title="算数函数"></a>算数函数</h3><p>绝对值：ABS<br>　　绝对值（absolute value）不考虑数值的符号，表示一个数到原点的距离。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> m,</span><br><span class="line">       <span class="keyword">ABS</span>(m) <span class="keyword">AS</span> abs_col</span><br><span class="line">  <span class="keyword">FROM</span> SampleMath;</span><br></pre></td></tr></table></figure>

<p>求余：MOD（modulo 的缩写）<br>四舍五入：<code>ROUND(&lt;列名&gt;, 四舍五入位数)</code></p>
<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><p>拼接：<code>CONCAT(字符串1, 字符串2)</code><br>计算字符串长度：<code>LENGTH</code> 和 <code>CHAR_LENGTH</code>（推荐）<br>小写转换：<code>LOWER</code><br>大写转换：<code>UPPER</code><br>替换：<code>REPLACE(对象字符串，替换前的字符串，替换后的字符串)</code><br>字符串截取：<code>SUBSTRING（对象字符串 FROM 截取的起始位置 FOR 截取的字符数）</code>　截取的起始位置从字符串最左侧开始计算。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> str1,</span><br><span class="line">       <span class="keyword">UPPER</span>(str1) <span class="keyword">AS</span> up_str</span><br><span class="line">  <span class="keyword">FROM</span> SampleStr</span><br><span class="line"> <span class="keyword">WHERE</span> str1 <span class="keyword">IN</span> (<span class="string">'ABC'</span>, <span class="string">'aBC'</span>, <span class="string">'abc'</span>, <span class="string">'山田'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><p>当前日期：<code>SELECT CURRENT_DATE;</code><br>当前时间：<code>SELECT CURRENT_TIME</code><br>当前日期和时间：<code>SELECT CURRENT_TIMESTAMP;</code><br>截取日期元素：<code>EXTRACT(日期元素 FROM 日期)</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">EXTRACT</span>(<span class="keyword">YEAR</span>   <span class="keyword">FROM</span> <span class="keyword">CURRENT_TIMESTAMP</span>)   <span class="keyword">AS</span> <span class="keyword">year</span>,</span><br><span class="line">       <span class="keyword">EXTRACT</span>(<span class="keyword">MONTH</span>  <span class="keyword">FROM</span> <span class="keyword">CURRENT_TIMESTAMP</span>)   <span class="keyword">AS</span> <span class="keyword">month</span>,</span><br><span class="line">       <span class="keyword">EXTRACT</span>(<span class="keyword">DAY</span>    <span class="keyword">FROM</span> <span class="keyword">CURRENT_TIMESTAMP</span>)   <span class="keyword">AS</span> <span class="keyword">day</span>,</span><br><span class="line">       <span class="keyword">EXTRACT</span>(<span class="keyword">HOUR</span>   <span class="keyword">FROM</span> <span class="keyword">CURRENT_TIMESTAMP</span>)   <span class="keyword">AS</span> <span class="keyword">hour</span>,</span><br><span class="line">       <span class="keyword">EXTRACT</span>(<span class="keyword">MINUTE</span> <span class="keyword">FROM</span> <span class="keyword">CURRENT_TIMESTAMP</span>)   <span class="keyword">AS</span> <span class="keyword">minute</span>,</span><br><span class="line">       <span class="keyword">EXTRACT</span>(<span class="keyword">SECOND</span> <span class="keyword">FROM</span> <span class="keyword">CURRENT_TIMESTAMP</span>)   <span class="keyword">AS</span> <span class="keyword">second</span>;</span><br></pre></td></tr></table></figure>

<h3 id="转换函数"><a href="#转换函数" class="headerlink" title="转换函数"></a>转换函数</h3><p>类型转换：<code>CAST（转换前的值 AS 想要转换的数据类型）</code><br><code>SELECT CAST(&#39;2009-12-14&#39; AS DATE) AS date_col;</code><br>将 NULL 转换为其他值：<code>COALESCE(数据1，数据2，数据3……)</code>　会返回参数中从左数第 1 个非 NULL 的值。<br><code>SELECT COALESCE(NULL, 1);</code></p>
<h2 id="6-2-谓词"><a href="#6-2-谓词" class="headerlink" title="6-2　谓词"></a>6-2　谓词</h2><p>　　谓词就是返回值为真值的函数。<br>　　通常的函数返回值有可能是数字、字符串或者日期等，但是谓词的返回值全都是真值（TRUE/FALSE/UNKNOWN）<br>　　<code>=、&lt;、&gt;、&lt;&gt;</code>等比较运算符，其正式的名称就是比较谓词。</p>
<p>模式匹配：<br>　　LIKE 谓词比 = 更模糊，需要字符串部分一致时使用。<br>　　部分一致大体可以分为前方一致、中间一致和后方一致三种类型。<br>　　<code>%</code>是代表“0 字符以上的任意字符串”的特殊符号。<br>　　前方一致：<code>ddd%</code><br>　　中间一致：<code>%ddd%</code><br>　　后方一致：<code>%ddd</code></p>
<figure class="highlight sql"><figcaption><span>查询以 ddd 开头的所有字符串</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line">  <span class="keyword">FROM</span> SampleLike</span><br><span class="line"> <span class="keyword">WHERE</span> strcol <span class="keyword">LIKE</span> <span class="string">'ddd%'</span>;</span><br></pre></td></tr></table></figure>
<p>　　还可以使用<code>_</code>（下划线）来代替<code>%</code>，代表任意一个字符。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line">  <span class="keyword">FROM</span> SampleLike</span><br><span class="line"> <span class="keyword">WHERE</span> strcol <span class="keyword">LIKE</span> <span class="string">'abc_ _'</span>;</span><br></pre></td></tr></table></figure>

<p>范围查询：<br>　　<code>BETWEEN a AND b</code>　等于<code>[a, b]</code>，不想要临界值，就只能用<code>? &gt; a
AND ? &lt; b</code></p>
<figure class="highlight sql"><figcaption><span>选取销售单价为 100 ～ 1000 日元的商品</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, sale_price</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> sale_price <span class="keyword">BETWEEN</span> <span class="number">100</span> <span class="keyword">AND</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<p>判断是否为<code>NULL</code>：<br>　　为了选取出某些值为<code>NULL</code>的列的数据，不能使用<code>=</code>，而只能使用特<br>定的谓词<code>IS NULL</code></p>
<figure class="highlight sql"><figcaption><span>选取出进货单价为NULL的商品</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, purchase_price</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> purchase_price <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>
<p>　　想要选取<code>NULL</code>以外的数据时，需要使用<code>IS NOT NULL</code></p>
<p>OR 的简便用法：<code>IN( 值, ……)</code><br>　　选取“进货单价不是 x、x”的商品时，可以使用否定形式<code>NOT IN( 值, ……)</code></p>
<figure class="highlight sql"><figcaption><span>选取出进货单价为 320 日元、500 日元、5000 日元的商品。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, purchase_price</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> purchase_price <span class="keyword">IN</span> (<span class="number">320</span>, <span class="number">500</span>, <span class="number">5000</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, sale_price</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"> <span class="keyword">WHERE</span> product_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> product_id</span><br><span class="line">                            <span class="keyword">FROM</span> ShopProduct</span><br><span class="line">                           <span class="keyword">WHERE</span> shop_id = <span class="string">'000A'</span>);</span><br></pre></td></tr></table></figure>

<p>存在：EXIST 谓词<br>　　通常指定关联子查询作为<code>EXIST</code>的参数。<br>　　作为<code>EXIST</code>参数的子查询中经常会使用<code>SELECT *</code>。<br>　　使用<code>NOT EXIST</code>替换<code>NOT IN</code><br>　　没有必要勉强使用<code>EXIST</code>，因为<code>EXIST</code>拥有<code>IN</code>所不具有的便利性。</p>
<figure class="highlight sql"><figcaption><span>使用EXIST选取出“大阪店在售商品的销售单价”</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, sale_price</span><br><span class="line">  <span class="keyword">FROM</span> Product <span class="keyword">AS</span> P</span><br><span class="line"> <span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> *</span><br><span class="line">                <span class="keyword">FROM</span> ShopProduct <span class="keyword">AS</span> SP</span><br><span class="line">               <span class="keyword">WHERE</span> SP.shop_id = <span class="string">'000C'</span></span><br><span class="line">                 <span class="keyword">AND</span> SP.product_id = P.product_id);</span><br></pre></td></tr></table></figure>

<h2 id="6-3-CASE表达式"><a href="#6-3-CASE表达式" class="headerlink" title="6-3　CASE表达式"></a>6-3　CASE表达式</h2><p>　　CASE 表达式是在区分情况时使用的，这种情况的区分在编程中通常称为（条件）分支</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CASE WHEN &lt;求值表达式&gt; THEN &lt;表达式&gt;</span><br><span class="line">     WHEN &lt;求值表达式&gt; THEN &lt;表达式&gt;</span><br><span class="line">     WHEN &lt;求值表达式&gt; THEN &lt;表达式&gt;</span><br><span class="line">     ...</span><br><span class="line">     ELSE &lt;表达式&gt;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name,</span><br><span class="line"><span class="keyword">CASE</span> <span class="keyword">WHEN</span> product_type = <span class="string">'衣服'</span></span><br><span class="line"><span class="keyword">THEN</span> <span class="keyword">CONCAT</span>(<span class="string">'A ：'</span>, product_type)</span><br><span class="line"><span class="keyword">WHEN</span> product_type = <span class="string">'办公用品'</span></span><br><span class="line"><span class="keyword">THEN</span> <span class="keyword">CONCAT</span>(<span class="string">'B ：'</span>, product_type)</span><br><span class="line"><span class="keyword">WHEN</span> product_type = <span class="string">'厨房用具'</span></span><br><span class="line"><span class="keyword">THEN</span> <span class="keyword">CONCAT</span>(<span class="string">'C ：'</span>, product_type)</span><br><span class="line"><span class="keyword">ELSE</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">END</span> <span class="keyword">AS</span> abc_product_type</span><br><span class="line"><span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">product_name | abc_product_type</span><br><span class="line"><span class="comment">---------------+------------------</span></span><br><span class="line">T恤衫         | A ：衣服</span><br><span class="line">打孔器        | B ：办公用品</span><br><span class="line">运动T恤       | A ：衣服</span><br><span class="line">菜刀          | C ：厨房用具</span><br><span class="line">高压锅        | C ：厨房用具</span><br><span class="line">叉子          | C ：厨房用具</span><br><span class="line">擦菜板        | C ：厨房用具</span><br><span class="line">圆珠笔        | B ：办公用品</span><br></pre></td></tr></table></figure>

<h1 id="第7章-集合运算"><a href="#第7章-集合运算" class="headerlink" title="第7章　集合运算"></a>第7章　集合运算</h1><h2 id="7-1-表的加减法"><a href="#7-1-表的加减法" class="headerlink" title="7-1　表的加减法"></a>7-1　表的加减法</h2><p>　　集合在数学领域表示“事物的总和”，在数据库领域表示记录的集合，表、视图和查询的执行结果都是记录的集合。<br>　　集合运算符会除去重复的记录，使用<code>ALL</code>选项，可以保留重复行。</p>
<p>表的加法：UNION（并集），包含重复行使用<code>UNION ALL</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_id, product_name</span><br><span class="line">  <span class="keyword">FROM</span> Product</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> product_id, product_name</span><br><span class="line">  <span class="keyword">FROM</span> Product2;</span><br></pre></td></tr></table></figure>

<p>注意事项：</p>
<ol>
<li>列数必须相同</li>
<li>列的类型必须一致</li>
<li>可以使用任何<code>SELECT</code>语句，但<code>ORDER BY</code>子句只能在最后使用一次</li>
</ol>
<h2 id="7-2-联结（以列为单位对表进行联结）"><a href="#7-2-联结（以列为单位对表进行联结）" class="headerlink" title="7-2　联结（以列为单位对表进行联结）"></a>7-2　联结（以列为单位对表进行联结）</h2><h3 id="内联结"><a href="#内联结" class="headerlink" title="内联结"></a>内联结</h3><p>　　应用最广泛的联结运算。<br>　　所谓联结运算，就是“以 A 中的列作为桥梁，将 B 中满足同样条件的列汇集到同一结果之中”。<br>　　常用<code>=</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SP.shop_id, SP.shop_name, SP.product_id, P.product_name, P.sale_price</span><br><span class="line">  <span class="keyword">FROM</span> ShopProduct <span class="keyword">AS</span> SP <span class="keyword">INNER</span> <span class="keyword">JOIN</span> Product <span class="keyword">AS</span> P</span><br><span class="line">    <span class="keyword">ON</span> SP.product_id = P.product_id;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SP.shop_id, SP.shop_name, SP.product_id, P.product_name, P.sale_price, IP.inventory_quantity</span><br><span class="line">  <span class="keyword">FROM</span> ShopProduct <span class="keyword">AS</span> SP <span class="keyword">INNER</span> <span class="keyword">JOIN</span> Product <span class="keyword">AS</span> P</span><br><span class="line">    <span class="keyword">ON</span> SP.product_id = P.product_id</span><br><span class="line">          <span class="keyword">INNER</span> <span class="keyword">JOIN</span> InventoryProduct <span class="keyword">AS</span> IP</span><br><span class="line">             <span class="keyword">ON</span> SP.product_id = IP.product_id</span><br><span class="line"> <span class="keyword">WHERE</span> IP.inventory_id = <span class="string">'P001'</span>;</span><br></pre></td></tr></table></figure>

<p>　　<code>INNER</code>可省略。<br>　　<code>SP</code>和<code>P</code>分别是这两张表的别名，并不是必需的。但由于表名太长会影响语句的可读性，因此还是希望大家能够习惯使用别名。<br>　　<code>ON</code>是专门用来指定联结条件的，它能起到与<code>WHERE</code>相同的作用。需要指定多个键时，同样可以使用<code>AND</code>、<code>OR</code>。<br>　　联结条件也可以使用“=”来记述。还可以使用<code>&lt;=</code>和<code>BETWEEN</code>等谓词。但因为实际应用中九成以上都可以用“=”进行联结，所以开始时只要记住使用“=”就可以了。<br>　　使用联结时<code>SELECT</code>子句中的列需要按照<code>&lt;表的别名&gt;.&lt;列名&gt;</code>的格式书写。</p>
<h3 id="外联结"><a href="#外联结" class="headerlink" title="外联结"></a>外联结</h3><p>　　外联结中使用LEFT、RIGHT来指定主表。使用二者所得到的结果完全相同。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SP.shop_id, SP.shop_name, SP.product_id, P.product_name, P.sale_price</span><br><span class="line">  <span class="keyword">FROM</span> ShopProduct <span class="keyword">AS</span> SP <span class="keyword">RIGHT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> Product <span class="keyword">AS</span> P</span><br><span class="line">    <span class="keyword">ON</span> SP.product_id = P.product_id;</span><br></pre></td></tr></table></figure>

<h3 id="TOP-限制查询结果"><a href="#TOP-限制查询结果" class="headerlink" title="TOP 限制查询结果"></a>TOP 限制查询结果</h3><p>　　显示结果前几行：<code>SELECT TOP n [percent] [WITH TIES]</code>　百分之 n，包含重复行 <code>WITH TIES</code>必须使用 <code>ORDER BY</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">3</span> <span class="keyword">WITH</span> <span class="keyword">TIES</span> sname, sage, sdept</span><br><span class="line">  <span class="keyword">FROM</span> Students</span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> sage <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h1 id="第8章-SQL高级处理"><a href="#第8章-SQL高级处理" class="headerlink" title="第8章　SQL高级处理"></a>第8章　SQL高级处理</h1><h2 id="8-1-窗口函数"><a href="#8-1-窗口函数" class="headerlink" title="8-1　窗口函数"></a>8-1　窗口函数</h2><h3 id="专用窗口函数"><a href="#专用窗口函数" class="headerlink" title="专用窗口函数"></a>专用窗口函数</h3><p>　　在<code>Oracle</code>和<code>SQL Server</code>中称为分析函数。<br>　　窗口函数就是将表以窗口为单位进行分割，并在其中进行排序的函数。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;窗口函数&gt; OVER ([PARTITION BY &lt;列清单&gt;]</span><br><span class="line">                        ORDER BY &lt;排序用列清单&gt;)</span><br></pre></td></tr></table></figure>
<p>窗口函数大体可以分为：<br>① 能够作为窗口函数的聚合函数（SUM、AVG、COUNT、MAX、MIN）<br>② RANK、DENSE_RANK、ROW_NUMBER 等专用窗口函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_name, product_type, sale_price,</span><br><span class="line">       <span class="keyword">RANK</span> () <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> product_type</span><br><span class="line">                         <span class="keyword">ORDER</span> <span class="keyword">BY</span> sale_price) <span class="keyword">AS</span> ranking</span><br><span class="line"> <span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>
<p>　　<code>PARTITION BY</code>能够设定排序的对象范围。本例中，为了按照商品种类进行排序，指定了<code>product_type</code>，分组后的记录集合称为窗口，窗口代表范围。<br>　　<code>ORDER BY</code>能够指定按照哪一列、何种顺序进行排序。为了按照销售单价的升序进行排列，指定了<code>sale_price</code><br>　　窗口函数兼具分组和排序两种功能<br>　　使用窗口函数时起到关键作用的是<code>PARTITION BY</code>和<code>GROUP BY</code>。其中，<code>PARTITION BY</code>并不是必需的，即使不指定也可以正常使用窗口函数。<br>　　由于专用窗口函数无需参数，因此通常括号中都是空的<br>　　窗口函数只能在SELECT子句中使用</p>
<p>　　RANK 函数<br>　　例）有3 条记录排在第 1 位时：1 位、1 位、1 位、4 位……<br>　　DENSE_RANK 函数<br>　　例）有3 条记录排在第 1 位时：1 位、1 位、1 位、2 位……<br>　　ROW_NUMBER 函数<br>　　例）有3 条记录排在第 1 位时：1 位、2 位、3 位、4 位……</p>
<h3 id="作为窗口函数使用的聚合函数"><a href="#作为窗口函数使用的聚合函数" class="headerlink" title="作为窗口函数使用的聚合函数"></a>作为窗口函数使用的聚合函数</h3><p>　　所有的聚合函数都能用作窗口函数，其语法和专用窗口函数完全相同。</p>
<figure class="highlight sql"><figcaption><span>计算各个时间的销售额总额</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> product_id, product_name, sale_price,</span><br><span class="line">     <span class="keyword">SUM</span> (sale_price) <span class="keyword">OVER</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> product_id) <span class="keyword">AS</span> current_sum</span><br><span class="line">  <span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>

<h2 id="8-2-GROUPING运算符"><a href="#8-2-GROUPING运算符" class="headerlink" title="8-2　GROUPING运算符"></a>8-2　GROUPING运算符</h2><h1 id="第九章-通过应用程序连接数据库"><a href="#第九章-通过应用程序连接数据库" class="headerlink" title="第九章　通过应用程序连接数据库"></a>第九章　通过应用程序连接数据库</h1><h2 id="9-1-数据库世界和应用程序世界的连接"><a href="#9-1-数据库世界和应用程序世界的连接" class="headerlink" title="9-1　数据库世界和应用程序世界的连接"></a>9-1　数据库世界和应用程序世界的连接</h2><p>　　说到“driver”这个词，大家可能会一下子想到螺丝刀。英语中这两者确实是同一个单词。实际上，螺丝刀也是用来把两个部件连接在一起的，从广义上来说也能叫桥梁。在计算机的世界里，那些用来将打印机、键盘和鼠标等连接到电脑上的程序也被称为“驱动”，它同样肩负着“连接不同机器”的使命。</p>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\humans-need-not-apply\" rel="bookmark">《人工智能时代》书摘</a></div>
    </li>
  </ul>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" rel="tag"># 计算机科学</a>
          </div>

        
  <div class="post-widgets">
    <div class="wp_rating">
      <div id="wpac-rating"></div>
    </div>
  </div>


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/processing/" rel="prev" title="音视频处理">
      <i class="fa fa-chevron-left"></i> 音视频处理
    </a></div>
      <div class="post-nav-item">
    <a href="/office-link/" rel="next" title="Office 2019/365 修改默认安装路径及激活方法">
      Office 2019/365 修改默认安装路径及激活方法 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#第0章-绪论——搭建SQL的学习环境"><span class="nav-text">第0章　绪论——搭建SQL的学习环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第1章-数据库和SQL"><span class="nav-text">第1章　数据库和SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-数据库是什么"><span class="nav-text">1-1　数据库是什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-数据库的结构"><span class="nav-text">1-2　数据库的结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-SQL概要"><span class="nav-text">1-3　SQL概要</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL语句及其种类"><span class="nav-text">SQL语句及其种类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL的基本书写规则"><span class="nav-text">SQL的基本书写规则</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-表的创建"><span class="nav-text">1-4　表的创建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库和表的创建"><span class="nav-text">数据库和表的创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命名规则"><span class="nav-text">命名规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据类型的指定"><span class="nav-text">数据类型的指定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#约束的设置"><span class="nav-text">约束的设置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-表的删除和更新"><span class="nav-text">1-5　表的删除和更新</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第2章-查询基础"><span class="nav-text">第2章　查询基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-SELECT语句基础"><span class="nav-text">2-1　SELECT语句基础</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-算术运算符和比较运算符"><span class="nav-text">2-2　算术运算符和比较运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#算术运算符"><span class="nav-text">算术运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#比较运算符"><span class="nav-text">比较运算符</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-逻辑运算符"><span class="nav-text">2-3　逻辑运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#NOT-运算符"><span class="nav-text">NOT 运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AND-运算符和-OR-运算符"><span class="nav-text">AND 运算符和 OR 运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#逻辑运算符和真值"><span class="nav-text">逻辑运算符和真值</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第3章-聚合与排序"><span class="nav-text">第3章　聚合与排序</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-对表进行聚合查询"><span class="nav-text">3-1　对表进行聚合查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#聚合函数"><span class="nav-text">聚合函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-对表分组"><span class="nav-text">3-2　对表分组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-为聚合结果指定条件"><span class="nav-text">3-3　为聚合结果指定条件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-对查询结果进行排序"><span class="nav-text">3-4　对查询结果进行排序</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第4章-数据更新"><span class="nav-text">第4章　数据更新</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-数据的插入（INSERT语句的使用方法）"><span class="nav-text">4-1　数据的插入（INSERT语句的使用方法）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-数据的删除（DELETE语句的使用方法）"><span class="nav-text">4-2　数据的删除（DELETE语句的使用方法）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-数据的更新（UPDATE语句的使用方法）"><span class="nav-text">4-3　数据的更新（UPDATE语句的使用方法）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-事务"><span class="nav-text">4-4　事务</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第5章-复杂查询"><span class="nav-text">第5章　复杂查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-视图"><span class="nav-text">5-1　视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-子查询"><span class="nav-text">5-2　子查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-关联子查询"><span class="nav-text">5-3　关联子查询</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第6章-函数、谓词、CASE表达式"><span class="nav-text">第6章　函数、谓词、CASE表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-各种各样的函数"><span class="nav-text">6-1　各种各样的函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#算数函数"><span class="nav-text">算数函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串函数"><span class="nav-text">字符串函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#日期函数"><span class="nav-text">日期函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#转换函数"><span class="nav-text">转换函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-谓词"><span class="nav-text">6-2　谓词</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-CASE表达式"><span class="nav-text">6-3　CASE表达式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第7章-集合运算"><span class="nav-text">第7章　集合运算</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-表的加减法"><span class="nav-text">7-1　表的加减法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-联结（以列为单位对表进行联结）"><span class="nav-text">7-2　联结（以列为单位对表进行联结）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#内联结"><span class="nav-text">内联结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#外联结"><span class="nav-text">外联结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TOP-限制查询结果"><span class="nav-text">TOP 限制查询结果</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第8章-SQL高级处理"><span class="nav-text">第8章　SQL高级处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-窗口函数"><span class="nav-text">8-1　窗口函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#专用窗口函数"><span class="nav-text">专用窗口函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#作为窗口函数使用的聚合函数"><span class="nav-text">作为窗口函数使用的聚合函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-GROUPING运算符"><span class="nav-text">8-2　GROUPING运算符</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第九章-通过应用程序连接数据库"><span class="nav-text">第九章　通过应用程序连接数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-数据库世界和应用程序世界的连接"><span class="nav-text">9-1　数据库世界和应用程序世界的连接</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="千灵夙赋"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">千灵夙赋</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">164</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Friends
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://myloveru.cn/" title="http:&#x2F;&#x2F;myloveru.cn&#x2F;" rel="noopener" target="_blank">梦想博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://meow3.family.blog/" title="https:&#x2F;&#x2F;meow3.family.blog&#x2F;" rel="noopener" target="_blank">恶魔菌の记事簿</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://myoumeng.github.io/" title="https:&#x2F;&#x2F;myoumeng.github.io&#x2F;" rel="noopener" target="_blank">彼岸遇见欧萌</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://tding.top/" title="https:&#x2F;&#x2F;tding.top&#x2F;" rel="noopener" target="_blank">小丁的个人博客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.julydate.com/" title="https:&#x2F;&#x2F;www.julydate.com&#x2F;" rel="noopener" target="_blank">七夏浅笑</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://raspii.tech/" title="https:&#x2F;&#x2F;raspii.tech&#x2F;" rel="noopener" target="_blank">无用挂件</a>
        </li>
    </ul>
  </div>
<div id="aplayer" class="aplayer"></div>
<script>
if( !/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)){
  document.write('<script type="text/javascript" src="/js/custom/APlayer.min.js"><\/script>');
}
</script>
<script type="text/javascript">
var ap = new APlayer({
    element: document.getElementById('aplayer'),                       // Optional, player element
    narrow: false,                                                     // Optional, narrow style
    autoplay: false,                                                    // Optional, autoplay song(s), not supported by mobile browsers
    showlrc: 0,                                                        // Optional, show lrc, can be 0, 1, 2, see: ###With lrc
    mutex: true,                                                       // Optional, pause other players when this player playing
    theme: '#e6d0b2',                                                  // Optional, theme color, default: #b7daff
    mode: 'random',                                                    // Optional, play mode, can be `random` `single` `circulation`(loop) `order`(no loop), default: `circulation`
    preload: 'metadata',                                               // Optional, the way to load music, can be 'none' 'metadata' 'auto', default: 'auto'
    listmaxheight: '513px',                                             // Optional, max height of play list
    music: [{
      title: '世末歌者',
      author: '双笙 囧菌',
      url: '/music/%E5%8F%8C%E7%AC%99%20%E5%9B%A7%E8%8F%8C%20-%20%E4%B8%96%E6%9C%AB%E6%AD%8C%E8%80%85.mp3',
      pic: '/images/aplayer/双笙　囧菌 - 世末歌者.webp',
    }, {
      title: '幹物女(WeiWei)',
      author: '封茗囧菌',
      url: '/music/%E5%B0%81%E8%8C%97%E5%9B%A7%E8%8F%8C%20-%20%E5%B9%B9%E7%89%A9%E5%A5%B3(WeiWei).mp3',
      pic: '/images/aplayer/封茗囧菌 - 幹物女(WeiWei).webp',
    }, {
      title: '东京不太热',
      author: '封茗囧菌',
      url: '/music/%E5%B0%81%E8%8C%97%E5%9B%A7%E8%8F%8C%20-%20%E4%B8%9C%E4%BA%AC%E4%B8%8D%E5%A4%AA%E7%83%AD.mp3',
      pic: '/images/aplayer/封茗囧菌 - 东京不太热.webp',
    }, {
      title: '有故事的小仙女（Cover 初音ミク）',
      author: '井宿',
      url: '/music/%E4%BA%95%E5%AE%BF%20-%20%E6%9C%89%E6%95%85%E4%BA%8B%E7%9A%84%E5%B0%8F%E4%BB%99%E5%A5%B3%EF%BC%88Cover%20%E5%88%9D%E9%9F%B3%E3%83%9F%E3%82%AF%EF%BC%89.mp3',
      pic: '/images/aplayer/井宿 - 有故事的小仙女（Cover 初音ミク）.webp',
    }, {
      title: '拼凑的断音（Cover 洛天依）',
      author: '泡泡Hansy',
      url: '/music/%E6%B3%A1%E6%B3%A1Hansy%20-%20%E6%8B%BC%E5%87%91%E7%9A%84%E6%96%AD%E9%9F%B3%EF%BC%88Cover%20%E6%B4%9B%E5%A4%A9%E4%BE%9D%EF%BC%89.mp3',
      pic: '/images/aplayer/泡泡Hansy - 拼凑的断音（Cover 洛天依）.webp',
    }]
  });
</script>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-tv"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">千灵夙赋</span>
</div>

        
<div class="busuanzi-count">
  <script pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-"></i>你是第
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>位到访的小伙伴喔
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-"></i>本站已被访问
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>次啦
      </span>
    </span>
</div>






  <script pjax>
  function leancloudSelector(url) {
    url = encodeURI(url);
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.getAttribute('id'));
      var title = visitors.getAttribute('data-flag-title');

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
              leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .catch(error => {
                console.error('Failed to save visitor count', error);
              })
          } else {
              Counter('post', '/classes/Counter', { title: title, url: url, time: 1 })
                .then(response => response.json())
                .then(() => {
                  leancloudSelector(url).innerText = 1;
                })
                .catch(error => {
                  console.error('Failed to create', error);
                });
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.getAttribute('id'));
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (let item of results) {
            let { url, time } = item;
            leancloudSelector(url).innerText = time;
          }
          for (let url of entries) {
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=zulMeib4pyC6zB1a65OmVtHz-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id'     : 'zulMeib4pyC6zB1a65OmVtHz-gzGzoHsz',
            'X-LC-Key'    : 'TEjUlOUBz3KwSUmDQ35ROxpw',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.getAttribute('pjax') !== null) {
      script.setAttribute('pjax', '');
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  
  <script pjax>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>



  <script pjax>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : 8657,
      el    : 'wpac-rating',
      color : '5bc0de'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>

  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout: 3000,
        priority: true,
        ignores: [uri => uri.includes('#'),uri => uri == 'https://qianling.pw/sql/',]
      });
      });
  </script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://qianling-1254036047.cos.ap-chengdu.myqcloud.com/js/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'zulMeib4pyC6zB1a65OmVtHz-gzGzoHsz',
      appKey     : 'TEjUlOUBz3KwSUmDQ35ROxpw',
      placeholder: "biu biu~　||ヽ(*￣▽￣*)ノミ|Ю",
      avatar     : 'wavatar',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

    </div>
</body>
</html>
